<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <style>
      body {
      background-color: rgb(25, 136, 184);
      text-align: center;

      -ms-overflow-style: none; /* for Internet Explorer, Edge */
      scrollbar-width: none; /* for Firefox */
      overflow-y: scroll; 
    }
    body::-webkit-scrollbar {
      display: none; /* for Chrome, Safari, and Opera */
    }
    .painel{
      margin: 0 auto;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      width: 40%;
      min-width: 28%;
    }

  </style>

    <title>Corrige arquivo!</title>
  </head>
  <body>

    <div class="painel">
      <label  for="formFileLg" class="form-label" style="display: none;">Por favor, selecione o arquivo!</label>
      <input type="file" onchange="loadFile(this.files[0])" class="form-control " />
    </div>

    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

    <!-- Option 2: Separate Popper and Bootstrap JS -->
    <!--
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
    -->

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.0/FileSaver.min.js"></script>
    <script>

      CNPJNFALSE = "08070508012184";
      CNPJSUBT   = "33453598000100";


      async function loadFile(file) {
        let text = await file.text();
        console.log(text.split(";"));
        // document.getElementById('output').textContent = text;
        convertArquivo(text);
      }

      // conteudoTXT = "exemplo ; com ; dados ; no ; formato ; csv";
      function convertArquivo(arquivo) {
        resultadoTXT = arquivo.split(";");
        output = "";
        valorTotal  = resultadoTXT.length;

        if (resultadoTXT[0] == CNPJNFALSE) {
          console.log(true);

          verificaArquivo();

          console.log(verificaArquivo());
          salvar(output);
        } else {
          verificaArquivo();
          salvar(output);
          console.log(falses)
        } 

       

        // console.log(resultadoTXT);S
      }

      function verificaArquivo() {
        for (let i = 0; i < resultadoTXT.length; i++) {

          if (resultadoTXT[i] == CNPJNFALSE) {
            resultadoTXT[i] = CNPJSUBT;
          }

          if (resultadoTXT[i] == "") {
            resultadoTXT[i] = " ";
          }

          if (i == (valorTotal -1)) {
            output += resultadoTXT[i];
          } else {
            output += resultadoTXT[i] + "; ";         
          }

        }
        
        return output;
      }

      function salvar(arquivo) {
        // let texto = document.getElementById("texto").value;
        // let titulo = document.getElementById("titulo").value;
        let blob = new Blob([arquivo], { type: "text/plain;charset=utf-8" });
        saveAs(blob, "teste" + ".txt");

        window.location.reload();
      }
    </script>
  </body>
</html>